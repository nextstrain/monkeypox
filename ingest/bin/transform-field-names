#!/usr/bin/env python3
"""
Renames fields of the NDJSON record from stdin and outputs modified records
to stdout.
"""
import argparse
import json
from sys import stdin, stdout


if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        description=__doc__,
        formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )
    parser.add_argument("--field-map", nargs="+",
        help="Fields names in the NDJSON record mapped to new field names, " +
             "formatted as '{old_field_name}={new_field_name}'. " +
             "If the old field does not exist in record, the new field will be added with an empty string value.")

    args = parser.parse_args()

    field_map = {}
    for field in args.field_map:
        old_name, new_name = field.split('=')
        field_map[old_name] = new_name

    for record in stdin:
        record = json.loads(record)

        for old_field, new_field in field_map.items():
            record[new_field] = record.pop(old_field, '')

        json.dump(record, stdout, allow_nan=False, indent=None, separators=',:')
        print()
